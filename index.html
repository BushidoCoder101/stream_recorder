<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Screen Recorder Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .recording-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: 9999px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
        }
        
        .classification-badge {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        
        .timer {
            font-variant-numeric: tabular-nums;
            font-feature-settings: 'tnum';
        }
    </style>
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>
</head>
<body class="min-h-screen gradient-bg text-white overflow-x-hidden">
    <!-- Header -->
    <header class="container mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold">AI Screen Recorder</h1>
                    <p class="text-sm text-white/70">Powered by TensorFlow.js</p>
                </div>
            </div>
            <div class="glass-effect px-4 py-2 rounded-lg">
                <span class="text-sm font-medium">Pro Version</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Controls Panel -->
            <div class="lg:col-span-1 space-y-4">
                <!-- Recording Controls -->
                <div class="glass-effect rounded-2xl p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
                        </svg>
                        Controls
                    </h2>
                    
                    <div class="space-y-3">
                        <button id="start" class="w-full btn-primary text-white font-semibold py-3 rounded-xl transition-all duration-300 flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Start Recording</span>
                        </button>
                        
                        <button id="stop" class="w-full btn-secondary text-white font-semibold py-3 rounded-xl transition-all duration-300 opacity-50 cursor-not-allowed flex items-center justify-center space-x-2" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                            </svg>
                            <span>Stop Recording</span>
                        </button>
                        
                        <button id="download" class="w-full btn-success text-white font-semibold py-3 rounded-xl transition-all duration-300 opacity-50 cursor-not-allowed flex items-center justify-center space-x-2" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            <span>Download Video</span>
                        </button>
                    </div>
                </div>

                <!-- Settings Panel -->
                <div class="glass-effect rounded-2xl p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Settings
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Record Type
                            </label>
                            <select id="recordType" class="w-full bg-white/10 backdrop-blur border border-white/20 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all appearance-none">
                                <option value="screen" class="bg-gray-900">Screen Only</option>
                                <option value="camera" class="bg-gray-900">Camera Only</option>
                                <option value="both" class="bg-gray-900">Screen + Camera</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Video Quality
                            </label>
                            <select id="quality" class="w-full bg-white/10 backdrop-blur border border-white/20 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all appearance-none">
                                <option value="1920x1080" class="bg-gray-900">Full HD (1920×1080)</option>
                                <option value="1280x720" class="bg-gray-900">HD (1280×720)</option>
                                <option value="854x480" class="bg-gray-900">SD (854×480)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                                File Format
                            </label>
                            <select id="fileType" class="w-full bg-white/10 backdrop-blur border border-white/20 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all appearance-none">
                                <option value="webm" class="bg-gray-900">WebM (Recommended)</option>
                                <option value="mp4" class="bg-gray-900">MP4</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Stats Panel -->
                <div class="glass-effect rounded-2xl p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Stats
                    </h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Duration</span>
                            <span class="font-mono font-semibold timer" id="timer">00:00:00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">Status</span>
                            <span class="font-semibold" id="status">Ready</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-white/70">AI Model</span>
                            <span class="font-semibold text-xs" id="model-status">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Preview Panel -->
            <div class="lg:col-span-2 fade-in">
                <div class="glass-effect rounded-2xl p-6 h-full">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold flex items-center">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Live Preview
                        </h2>
                        <div id="recording-indicator" class="recording-indicator hidden">
                            <span class="w-3 h-3 bg-red-500 rounded-full pulse-dot"></span>
                            <span class="text-sm font-semibold">Recording</span>
                        </div>
                    </div>
                    
                    <div class="video-container shadow-2xl">
                        <video id="video" playsinline muted></video>
                        <canvas id="canvas"></canvas>
                        
                        <!-- Classification Overlay -->
                        <div id="classification-overlay" class="absolute top-4 left-4 right-4 hidden">
                            <div class="classification-badge rounded-xl px-4 py-3 shadow-lg">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                        </svg>
                                        <span class="font-semibold text-sm">AI Detection:</span>
                                    </div>
                                    <span class="font-bold text-white" id="classification-result">Analyzing...</span>
                                </div>
                                <div class="mt-2 bg-white/30 rounded-full h-2 overflow-hidden">
                                    <div id="confidence-bar" class="bg-white h-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <div class="mt-1 text-xs text-white/80 text-right">
                                    <span id="confidence-text">0%</span> confidence
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Help Text -->
                    <div class="mt-4 text-sm text-white/70 text-center" id="help-text">
                        Click "Start Recording" to begin capturing your screen with AI-powered classification
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="container mx-auto px-4 py-6 mt-8">
        <div class="glass-effect rounded-xl p-4 text-center">
            <p class="text-sm text-white/70">Built with TensorFlow.js • MobileNet • MediaRecorder API</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const startButton = document.getElementById('start');
        const stopButton = document.getElementById('stop');
        const downloadButton = document.getElementById('download');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const canvasCtx = canvas.getContext('2d');
        const status = document.getElementById('status');
        const modelStatus = document.getElementById('model-status');
        const classificationResult = document.getElementById('classification-result');
        const confidenceBar = document.getElementById('confidence-bar');
        const confidenceText = document.getElementById('confidence-text');
        const classificationOverlay = document.getElementById('classification-overlay');
        const recordingIndicator = document.getElementById('recording-indicator');
        const timerElement = document.getElementById('timer');
        const helpText = document.getElementById('help-text');
        const qualitySelect = document.getElementById('quality');
        const fileTypeSelect = document.getElementById('fileType');
        const recordTypeSelect = document.getElementById('recordType');

        // State
        let mediaRecorder;
        let recordedChunks = [];
        let videoURL;
        let mobilenetModel;
        let isRecording = false;
        let isClassifying = false;
        let classificationInterval;
        let timerInterval;
        let recordingStartTime;

        // Initialize
        async function init() {
            try {
                await loadModel();
            } catch (error) {
                console.error('Initialization error:', error);
                modelStatus.textContent = 'Failed to load';
                modelStatus.classList.add('text-red-400');
            }
        }

        // Load MobileNet model
        async function loadModel() {
            try {
                modelStatus.textContent = 'Loading model...';
                modelStatus.classList.remove('text-green-400', 'text-red-400');
                
                mobilenetModel = await mobilenet.load();
                
                modelStatus.textContent = 'Ready';
                modelStatus.classList.add('text-green-400');
            } catch (error) {
                console.error('Error loading model:', error);
                modelStatus.textContent = 'Error';
                modelStatus.classList.add('text-red-400');
                throw error;
            }
        }

        // Format time for timer
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Update timer
        function startTimer() {
            recordingStartTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                timerElement.textContent = formatTime(elapsed);
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            timerElement.textContent = '00:00:00';
        }

        // Classify image from video
        async function classifyFrame() {
            if (!mobilenetModel || !isClassifying || !video.srcObject) return;

            try {
                const predictions = await mobilenetModel.classify(video);
                
                if (predictions && predictions.length > 0) {
                    const topPrediction = predictions[0];
                    classificationResult.textContent = topPrediction.className;
                    
                    const confidence = (topPrediction.probability * 100).toFixed(1);
                    confidenceBar.style.width = `${confidence}%`;
                    confidenceText.textContent = `${confidence}%`;
                    
                    classificationOverlay.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Classification error:', error);
            }
        }

        // Start classification loop
        function startClassification() {
            if (isClassifying) return;
            
            isClassifying = true;
            classificationInterval = setInterval(classifyFrame, 1000); // Classify every second
        }

        // Stop classification loop
        function stopClassification() {
            isClassifying = false;
            if (classificationInterval) {
                clearInterval(classificationInterval);
                classificationInterval = null;
            }
            classificationOverlay.classList.add('hidden');
        }

        // Get media streams based on record type
        async function getMediaStreams(recordType) {
            const [width, height] = qualitySelect.value.split('x').map(Number);
            let streams = [];

            try {
                if (recordType === 'screen' || recordType === 'both') {
                    const screenStream = await navigator.mediaDevices.getDisplayMedia({
                        video: {
                            width: { ideal: width },
                            height: { ideal: height },
                            frameRate: { ideal: 30 }
                        },
                        audio: true
                    });
                    streams.push(screenStream);
                }

                if (recordType === 'camera' || recordType === 'both') {
                    const cameraStream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            width: { ideal: width },
                            height: { ideal: height },
                            frameRate: { ideal: 30 }
                        },
                        audio: true
                    });
                    streams.push(cameraStream);
                    
                    // Set video source for preview and classification
                    video.srcObject = cameraStream;
                    await video.play();
                    
                    // Setup canvas
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    // Start AI classification
                    if (mobilenetModel) {
                        startClassification();
                    }
                }

                // Combine all tracks
                const combinedTracks = streams.flatMap(stream => stream.getTracks());
                return new MediaStream(combinedTracks);

            } catch (error) {
                console.error('Error accessing media devices:', error);
                throw error;
            }
        }

        // Start recording
        startButton.addEventListener('click', async () => {
            recordedChunks = [];
            const recordType = recordTypeSelect.value;

            try {
                status.textContent = 'Starting...';
                status.classList.remove('text-green-400', 'text-red-400');
                status.classList.add('text-yellow-400');

                const combinedStream = await getMediaStreams(recordType);
                
                // Determine MIME type
                let mimeType = 'video/webm;codecs=vp9,opus';
                if (fileTypeSelect.value === 'mp4') {
                    // MP4 is not widely supported in MediaRecorder, fallback to webm
                    console.warn('MP4 encoding may not be supported, using WebM');
                    mimeType = 'video/webm;codecs=vp9,opus';
                }

                if (!MediaRecorder.isTypeSupported(mimeType)) {
                    mimeType = 'video/webm'; // Fallback to basic webm
                }

                mediaRecorder = new MediaRecorder(combinedStream, {
                    mimeType: mimeType,
                    videoBitsPerSecond: 2500000 // 2.5 Mbps
                });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    videoURL = URL.createObjectURL(blob);
                    
                    // Stop all tracks
                    if (video.srcObject) {
                        video.srcObject.getTracks().forEach(track => track.stop());
                    }
                    
                    // Set video source to recorded video
                    video.srcObject = null;
                    video.src = videoURL;
                    video.controls = true;
                    video.muted = false;
                    
                    downloadButton.disabled = false;
                    downloadButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    
                    status.textContent = 'Completed';
                    status.classList.remove('text-yellow-400');
                    status.classList.add('text-green-400');
                    
                    helpText.textContent = 'Recording saved! You can now download or start a new recording.';
                    
                    stopTimer();
                    stopClassification();
                };

                mediaRecorder.start();
                isRecording = true;
                
                startButton.disabled = true;
                startButton.classList.add('opacity-50', 'cursor-not-allowed');
                
                stopButton.disabled = false;
                stopButton.classList.remove('opacity-50', 'cursor-not-allowed');
                
                recordingIndicator.classList.remove('hidden');
                
                status.textContent = 'Recording';
                status.classList.remove('text-yellow-400');
                status.classList.add('text-red-400');
                
                helpText.textContent = 'Recording in progress. Click "Stop Recording" when done.';
                
                startTimer();

            } catch (error) {
                console.error('Error starting recording:', error);
                status.textContent = 'Error';
                status.classList.add('text-red-400');
                helpText.textContent = 'Error: ' + error.message + '. Please check permissions and try again.';
                
                startButton.disabled = false;
                startButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        // Stop recording
        stopButton.addEventListener('click', () => {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                startButton.disabled = false;
                startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                
                stopButton.disabled = true;
                stopButton.classList.add('opacity-50', 'cursor-not-allowed');
                
                recordingIndicator.classList.add('hidden');
                
                status.textContent = 'Processing...';
                status.classList.remove('text-red-400');
                status.classList.add('text-yellow-400');
            }
        });

        // Download video
        downloadButton.addEventListener('click', () => {
            if (videoURL) {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const extension = fileTypeSelect.value === 'mp4' ? 'mp4' : 'webm';
                const filename = `recording-${timestamp}.${extension}`;
                
                const a = document.createElement('a');
                a.href = videoURL;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                helpText.textContent = `Downloaded as ${filename}`;
            }
        });

        // Initialize on load
        window.addEventListener('load', init);

        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            stopClassification();
            stopTimer();
        });
    </script>
</body>
</html>
